
# pentest-lab — локальная лаборатория для безопасной практики пентестинга

**Кратко:** готовая локальная лаборатория, набор безопасных инструментов-обёрток и шаблонов для обучения пентесту и подготовки портфолио/интервью. Всё заточено под локальную работу: Docker + DVWA, простые скрипты для сканирования и генерации отчётов, чек-листы, инструкция по безопасной работе.

> ⚠️ ВАЖНО: тестировать можно **только** свои машины или инфраструктуру, на которую у вас есть явное письменное разрешение. Нарушение этого правила — преступление. Этот репозиторий предназначен для обучения.

---

## Содержание этого README (быстрая навигация)
1. Что внутри репозитория  
2. Быстрый старт (установка и запуск)  
3. Подробные инструкции по каждому модулю и файлу  
4. Примеры использования (команды и ожидаемый вывод)  
5. Безопасность, правовые и этические правила  
6. Настройка CI / рекомендации по работе в командах  
7. Частые вопросы и решения проблем (FAQ / Troubleshooting)  
8. Как добавить свои задачи / contributions  
9. Сопроводительные материалы: лицензия, контакты, changelog

---

## 1. Что внутри репозитория

```text
pentest-lab/
├─ README.md                    # Этот файл (подробный)
├─ LICENSE                      # MIT
├─ .gitignore
├─ docker/
│  └─ docker-compose.yml        # docker compose для DVWA + mysql
├─ tools/
│  ├─ run_nmap.sh               # безопасная обёртка nmap (bash)
│  └─ nmap_parser.py            # nmap XML -> Markdown
├─ reports/
│  ├─ findings_template.md      # шаблон записи уязвимости
│  └─ checklist.md              # чек-лист для локальной проверки
├─ docs/
│  └─ safe_rules.md             # правила безопасности проекта
├─ challenges/
│  └─ web/                      # базовые веб-задачи / инструкции
├─ .github/
│  └─ workflows/ci.yml          # простой CI (линтер)
├─ CONTRIBUTING.md
└─ results/                     # (генерируется) результаты сканов, отчёты
```

---

## 2. Быстрый старт — шаг за шагом

### Требования
- Docker и Docker Compose (Docker Desktop содержит compose в комплекте).  
- nmap (для `tools/run_nmap.sh`).  
- Python 3.8+ (для `tools/nmap_parser.py`).  
- Git (для загрузки на GitHub).

### Клонирование репозитория
```bash
git clone https://github.com/<username>/pentest-lab.git
cd pentest-lab
```

### Поднятие DVWA локально (Linux/macOS/Windows with WSL)
```bash
cd docker
docker compose up -d
```
- Откройте `http://localhost:8080` в браузере.
- Для остановки и удаления данных (MySQL):  
```bash
docker compose down -v
```

### Windows PowerShell (если не используете WSL)
Откройте PowerShell от имени обычного пользователя (необязательно админ):
```powershell
cd docker
docker compose up -d
```

---

## 3. Подробно про модули и файлы

### docker/docker-compose.yml
- Поднимает 2 сервиса: `dvwa` (vulnerables/web-dvwa) и `mysql:5.7`.
- DVWA — учебная слабая веб-аппликация. Используйте только в локальной среде.
- Переменные окружения: `MYSQL_ROOT_PASSWORD=root`, база `dvwa`. При желании можете заменить пароли, но помните — это учебная среда.

### tools/run_nmap.sh
- Просто обёртка для запуска `nmap` безопасными опциями:
  - `-sS` — SYN scan (быстрый).
  - `-sV` — определение сервисов.
  - `-O` — определение ОС.
  - `-oX` — сохранить в XML.
- Скрипт **не** использует NSE-эксплойт-скрипты и не делает агрессивных атак. Если хотите добавить дополнительные опции — внимательно документируйте причины.

Пример запуска:
```bash
./tools/run_nmap.sh 127.0.0.1
# результат: results/scan_YYYYMMDD_HHMMSS.xml
```

### tools/nmap_parser.py
- Парсит output от `nmap -oX` и генерирует Markdown-отчёт с таблицей портов/сервисов.
- usage:
```bash
python3 tools/nmap_parser.py results/scan_YYYYMMDD_HHMMSS.xml results/scan.md
```
- Выходной `scan.md` удобно использовать как часть отчёта в `reports/`.

### reports/findings_template.md
- Шаблон одного finding-а: заголовок, серьёзность, шаги воспроизведения, влияние, remediation.
- Используйте этот шаблон для каждой найденной уязвимости — это повышает качество отчёта.

### reports/checklist.md
- Содержит пошаговый чек-лист для базовой проверки: поднять окружение, скан, анализ, remediation, проверка.

### docs/safe_rules.md
- Правила безопасности и поведения. Обязательно прочитайте перед использованием.

### .github/workflows/ci.yml
- Простой GitHub Actions workflow: линтер Python (flake8).
- CI рассчитан на безопасную проверку только вспомогательных скриптов (никаких автоматических тестов против поднятой инфраструктуры).

### CONTRIBUTING.md
- Правила вклада: PR обязаны быть безопасны, не содержать эксплойтов в коде, содержать описание.

---

## 4. Примеры использования и ожидаемый вывод

### 4.1 Полный пример (Linux/macOS)
```bash
git clone https://github.com/<username>/pentest-lab.git
cd pentest-lab

# Поднять окружение
cd docker
docker compose up -d
# Подождите ~10–30 секунд, пока контейнеры и БД инициализируются.

# В новом терминале:
cd ..
./tools/run_nmap.sh 127.0.0.1
# -> создаст results/scan_20251004_150001.xml (пример)

python3 tools/nmap_parser.py results/scan_20251004_150001.xml results/scan.md
# -> создаст results/scan.md

# Откройте results/scan.md — там будет таблица открытых портов и сервисов.
```

### 4.2 Ожидаемый фрагмент Markdown (пример)
```markdown
## Host: 127.0.0.1 — up

| Port | Proto | State | Service | Banner |
|---:|:---:|:---:|:---|:---|
| 80 | tcp | open | http | Apache httpd 2.4.29 |
| 3306 | tcp | open | mysql | MySQL 5.7.31 |
```

---

## 5. Настройки и расширенные варианты (с предупреждениями)

### Менять пароли и переменные
- В `docker/docker-compose.yml` можно заменить `MYSQL_ROOT_PASSWORD` и другие значения.
- Если делаете это — помните, что Docker volume `db_data` сохраняет БД между запусками. Для очистки:
```bash
docker compose down -v
docker volume rm pentest-lab_db_data || true
```

### Добавление дополнительных контейнеров
- Можно добавить сервисы: vulnerable web apps, old PHP apps, FTP, SMB.
- Каждый новый сервис увеличивает риск — запускайте только локально.

### Расширенный nmap (Только с разрешения)
Если вы хотите более глубокий анализ, используйте опции **только** в рамках разрешённой лаборатории:
```bash
nmap -sC -sV -p 1-65535 -oA fullscan 127.0.0.1
```
`-sC` — запускает безопасные стандартные NSE-скрипты. **Не** используйте рискованные NSE-скрипты без разрешения.

---

## 6. Безопасность, правовые и этические правила (обязательно прочитать)

1. **Разрешение.** Без явного письменного разрешения не тестируйте внешние сети.  
2. **Локальность.** Репозиторий предназначен для локальных тренингов и CTF-практики.  
3. **Нельзя публиковать эксплойты.** Не храните и не публикуйте реальные эксплойты, эксплойт-код или скомпрометированные данные.  
4. **Конфиденциальность.** Не публикуйте пароли, приватные ключи, персональные данные.  
5. **Этика.** Не используйте знания и инструменты для нанесения вреда.

Нарушение этих правил — личная ответственность.

---

## 7. CI / безопасность репозитория

- CI запускает только статический анализ (flake8). Не конфигурируйте CI для автоматических сканов внешних целей.  
- Перед пушем в публичный репозиторий убедитесь, что в коммите нет секретов:
  - Используйте `git status`, `git diff --staged`.
  - Можно применить pre-commit hooks (рекомендация): `pre-commit` + `detect-secrets`.

---

## 8. FAQ / Troubleshooting

### Q: `docker compose up` зависает или контейнер падает?
A:
- Проверьте логи: `docker compose logs dvwa` и `docker compose logs mysql`.
- Проверьте, не занят ли порт 8080: `ss -tuln | grep 8080` или `netstat -plnt`.
- На Windows убедитесь, что Docker Desktop запущен, и что WSL2 установлен (если используется).

### Q: `nmap` не установлен / команда не найдена
A:
- Linux (Debian/Ubuntu): `sudo apt update && sudo apt install nmap`
- macOS (Homebrew): `brew install nmap`
- Windows: установите Nmap с официального сайта и добавьте в PATH.

### Q: Python script не запускается (Encoding/Windows)
A:
- Убедитесь, что используете Python 3.8+.
- На Windows в PowerShell может понадобиться включить UTF-8: `chcp 65001` перед выводом, если появляются проблемы с кодировкой.

### Q: Как удалить все данные и начать заново?
A:
```bash
cd docker
docker compose down -v
# Удалите папку results/ если хотите очистить сканы
rm -rf ../results
```

---

## 9. Как добавить свои задачи / Contribution workflow

1. Создайте новую ветку: `git checkout -b feat/my-challenge`
2. Добавьте описание в `challenges/<type>/<name>/README.md`
3. В PR укажите:
   - Что делает challenge
   - Как поднять окружение
   - Как проверить (expected artifacts, флаги)
   - Убедитесь, что нет real-world exploit-кода

**PR checklist (локально перед PR):**
- [ ] Код линтится (flake8)
- [ ] В PR описаны шаги воспроизведения
- [ ] Нет секретов в коммитах
- [ ] README и docs обновлены

---

## 10. Примеры полезных расширений / идеи для развития
- Шаблоны отчетов в PDF (pandoc) для экспорта findings.  
- Интеграция с `gitlab-ci` / `github-actions` для автоматизированных тестов (локально эмулируемых).  
- Набор Windows-пакетов (PowerShell скрипты) для парсинга логов и базовых проверок.  
- Добавить unit tests для `tools/nmap_parser.py`.  

---

## 11. Changelog (коротко)
- 2025-10-04 — initial release: docker compose (DVWA), run_nmap.sh, nmap_parser.py, шаблоны, подробный README.

---

## 12. License & attribution
Проект распространяется под MIT License (см. файл `LICENSE`).  
Автор: <ваше имя или nickname>. Проект создан для учебных целей.

---

## 13. Полезные команды (шпаргалка)
```bash
# Git / GitHub
git add .
git commit -m "Initial commit: pentest-lab"
git push -u origin main

# Docker
cd docker
docker compose up -d
docker compose logs -f dvwa
docker compose down -v

# Сканы
./tools/run_nmap.sh 127.0.0.1
python3 tools/nmap_parser.py results/scan_YYYYMMDD_HHMMSS.xml results/scan.md
```

---

## 14. Контакты и поддержка
Если хотите — добавьте контакты в файл `AUTHORS.md` или в описание репозитория на GitHub. Для вопросов по коду можно открыть issue в репозитории.

---

### Финальные советы по загрузке на GitHub
1. Проверьте репозиторий на отсутствие секретов (`git log --stat`, `git status`).  
2. Инициализируйте git, добавьте remote и пушьте на `main` (см. раздел "Полезные команды").  
3. В настройках репозитория на GitHub включите `Issues` / `Discussions`, чтобы собирать обратную связь.

---

Спасибо — README обновлён и подробно описывает все аспекты работы с репозиторием.  
Файл уже добавлен в проект и архив будет пересоздан. Если нужно — могу также добавить `AUTHORS.md` или `.gitattributes`.  
